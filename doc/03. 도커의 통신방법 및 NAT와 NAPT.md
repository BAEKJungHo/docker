# 도커의 네트워크 구성

> 책 : 62p

Linux 는 도커를 설치하면 서버의 물리 NIC 가 `docer0` 라는 가상 브리지 네트워크로 연결된다. 이 docker0 는 도커를 실행시킨 후에 디폴트로 만들어진다.
도커 컨테이너가 실행되면 컨테이너에 `172.17.0.0./16`이라는 서브넷 마스크를 가진 프라이빗 IP 주소가 eth0 으로 자동으로 할당된다. 이 가상 NIC 는 OSI 참조 모델의 
레이어 2인 가상 네트워크 인터페이스로, 페어인 NIC 와 터널링 통신을 한다.

> 호스트 OS 의 8080 포트에 액세스 -> IP 마스커레이드(NAPT)를 통해서 컨테이너 PORT 80 으로 변환 (이 변환 기능은 물리 NIC 인 eth0 와 가상 브리지인 docker0 사이에서 일어난다.)

## NAT vs NAPT

- NAT(Network Address Translation)
  - 글로벌 IP 주소와 프라이빗 IP 주소를 1:1로 변환한다.
  - 따라서 여러 클라이언트가 액세스할 수 없다.
  
- NAPT(Network Adress Port Translation)
  - 프라이빗 IP 주소와 함께 포트 번호도 같이 변환하는 기술이다.
  - 프라이빗 IP 주소를 글로벌 IP 주소로 변환할 때 프라이빗 IP 주소별로 서로 다른 포트 번호로 변환한다.
    - ex) 클라이언트 A 가 보내온 요청은 1500 포트로, B 는 1600 포트로 변환
  - Linux 에서 NAPT 를 구축하는 것을 `IP 마스커레이드(mascarade, 가면무도회)`라고 부른다. 이것은 가면을 쓴 IP 패킷이 포트 번호의 가면을 붙여 변환되는 모습을 나타낸 것이다.
